# 第一章

## 接入网

### 家庭接入

- 数字用户线（DSL）：频分复用，利用本地电话基础设施，适合于短距离接入
- 电缆因特网接入：利用有线电视基础设施，共享广播媒体
- 光纤到户（FTTH）：提供直接到家庭的光纤路径，有潜力提供千兆每秒的因特网速率
- 卫星和拨号

### 企业和家庭接入

- 以太网
- WIFI

### 广域无线接入

- 3G
- LTE等

## 交换

### 分组交换

- 存储转发机制

### 电路交换

- 预留资源

## 时延、丢包、吞吐量、流量强度

- 4种时延，注意传输时延和传播时延
- 丢包：缓存队列已满，新到达的分组被丢弃
- 吞吐量：传输的bit/传输消耗的时间
- 流量强度：分组到达路由器的平均速率/传输速率；不能大于1

## 协议层次

- 协议栈：各层的所有协议被称为协议栈
- 五层因特网协议栈
- OSI模型

## 网络攻击

- 病毒：需要某种形式的用户交互来感染用户设备
- 蠕虫：无需任何明显用户交互就能进入设备
- DDoS：弱点攻击、带宽洪泛、连接洪泛
- IP哄骗

# 第二章

## P2P和CND

- p2p：无中心服务器、依靠用户群（peers）交换信息的互联网体系、
- P2P 就是人可以直接连接到其他用户的计算机、交换文件，而不是像过去那样连接到服务器去浏览与下载。
- CDN：将源站内容分发至最接近用户的节点，使用户可就近取得所需内容；
- CDN的建设需要花钱

## TCP和UDP

- TCP是面向连接的，提供可靠的数据传送服务
- UDP是无连接的，不可靠数据传送服务
- SSL：安全套接字层，是一种对TCP的加强

## HTTP

- 持续连接与非持续连接的差异
- 请求报文：请求行、首部行、请求体
- 响应报文：状态行、首部行、实体体

### Cookie

- 用于信息跟踪，由浏览器进行管理

## WEB缓存

- 缓存服务器用于减小Web流量，提升应用性能
- CDN

### 条件GET方法

- 用于判断缓存是否过期
- 响应报文没有实体体

## FTP

- 通过并行TCP连接来进行文件传输
- 控制连接：传输控制信息
- 数据连接：传输数据

## 电子邮件

### SMTP

- 用于从发送方的邮件服务器发送报文到接收方的邮件服务器
- client——》from邮件服务器——》to邮件服务器——》target
- 一般不使用中间服务器

### POP3

- 简单的邮件访问协议
- 下载并保留与下载并删除
- POP3很容易丢失邮件或多次下载相同的邮件

### IMAP

- 邮件客户端和网络邮件之间的双向同步功能，客户端的操作会被反馈到服务器上
- 提供摘要功能

### 基于Web电子邮件

- client和邮件服务器之间使用Http协议，邮件服务器之间任然使用SMTP协议

# 第三章

运输层协议为运行在不同主机上的应用进程之间提供了**逻辑通信**

## 运输层与网络层的关系

- 网络层提供主机之间的逻辑通信
- 运输层提供主机上进程之间的逻辑通信
- 运输层可以保证信息的可靠性，安全性

## 多路分解和多路复用

- 多路分解：将运输层报文段中的数据交付到正确的套接字工作
- 多路复用：把套接字中的数据封装称为报文段，传给网络层的工作
- 端口号：一个16bit的数，0~65535；0~1023为周知端口号

## 回退N步协议和选择重传

- 回退N步协议会重传出现错误之后的所有报文，即使后续报文是正确的
- 选择重传只会重传出错的报文，保存后续的正确报文

## TCP

- 通过四元组（目的IP、端口+源IP、端口）来标识套接字
- 面向连接、全双工、点对点
- MTU：最大传输单元（最大链路层帧长度）
- MSS：MTU+TCP首部

### 报文段结构

![img](https://s1.ax1x.com/2018/03/02/9rzlJf.png)

#### 序列号和确认号

- ACK ：主机A填充进报文段的确认号是主机A期望从主机B收到的下一字节的序号
- Seq = 0：数据流的起始序号
- 累积确认：TCP只确认该流中第一个丢失字节为止的字节（收到0-500和900-1000，ack=501）
- 失序到达：实际中，保留失序字节，并等待缺少的字节以填补该间隔

### 滑动窗口和拥塞窗口

- 对于数据接收端叫做滑动窗口
- 对于数据发送端叫做拥塞窗口
- 拥塞窗口的大小是根据滑动窗口大小外加网络情况决定的

#### 三次握手

1. 客户端向服务端发送一个SYN报文段，SYN置为1，随机选择一个初始序号
2. 服务端返回SYNACK报文，SYN置为1，ACK=client_seq+1
3. 客户端发送确认报文，SYN置为10，可以携带数据

最后一次握手是为了避免建立无用多余的TCP连接

SYN=1的报文段不能携带数据，也要消耗一个1序号

#### 四次挥手

1. 客户端发出连接释放报文段，FIN置为1
2. 服务端发出确认报文段，此时客户端到服务端方向的连接就已释放，处于半关闭状态
3. 服务端发出连接释放报文，FIN置为1
4. 客户端发出确认报文段，在等待2MSL（最长报文段寿命）后，TCP连接完全关闭

##### 等待时间的作用

- 为了保证最后一个报文段如果丢失，服务端重传倒数第二个报文段，客户端再次确认，保证服务端的关闭
- 为了保证超时的报文段到达，避免已失效的报文出现在后面的新TCP连接中
- FIN报文段即使不携带数据，也要消耗一个序号

#### 拥塞控制

1. 慢启动：最开始值发送一个MSS，每次被确认就增加一个MSS；起始慢，呈指数增长

   - 遇见丢包，`cwnd`设置为1，重新开始慢启动；`ssthresh`（慢启动阈值）设置为1/2

   - 当`cwnd`超过`ssthresh`时，转移到拥塞避免

   - 当检测到三个冗余ACK时，执行快速重传

2. 拥塞避免：线性增长

3. 快速恢复：对收到每个冗余ACK，`cwnd`增加一个MSS

## UDP

- 通过二元组（目的IP+目的端口）来标识
- UDP首部：源端口号+目的端口号+长度+检验和

### 特点

- 无需建立连接
- 无连接状态
- 分组首部开销小
- 关于何时、发送什么数据的应用层控制更为精细：因为不存在拥塞控制

# 第四章

## 概述

### 转发和路由选择

- 转发：强调的是路由器将分组从一个链路移动到另一个链路的动作
- 路由选择：强调的是分组从发送方到接收方，网络层决定分动作所采用的路径

### 虚电路和数据报网络

- 网络层提供无连接服务的是数据报网络
- 网络层提欧共有链接网络的是虚电路网络，需要连接建立和拆除的过程

### 数据报格式

![img](https://img-my.csdn.net/uploads/201204/10/1334067788_5038.jpg)

### 数据报分片

- IP数据报的大小受到链路层帧的MTU限制，不同的链路层协议的MTU不同
- 将IP数据报中的数据切片

#### 标识、标志和偏移字段

- 标识：同样的标识，表示这几个数据报是一个数据报的片
- 标志：最后一个被设置为0，其余为1
- 偏移字段：为了方便片完整的拼接

## IPV4

### 概述

- IP=主机号+网络号
- 子网掩码决定了网络号
- 无类别域间路由选择（CIDR）是因特网的地址分配策略
- 路由聚合：使用单个网络前缀通告多个网络的能力

### DHCP

- 动态主机配置协议、即插即用协议

1. 新加入网络的主机广播DHCP发现报文
2. DHCP服务器响应，发送DHCP提供报文，内容有IP地址租用期、推荐的IP地址等
3. 主机从多个服务器中选择一个，并发送DHCP请求报文
4. 服务器发送DHCP ACK报文，交互完成

### NAT

- 将局域网中的数据报被发送到广域网时，会将局域网中的IP地址转化为路由器的广域网IP地址
- NAT转发表：通过端口与局域网中的真正主机相对应、
- UPnP：用来实现内网穿透，一组（公共ID，公共端口号）固定对应（私有IP，私有端口号）

### ICMP（因特网控制报文协议）

- 被主机和路由器用来彼此沟通网络层的信息
- ICMP报文作为IP的有效载荷承载的
- ping和tracert命令分别基于·回显请求·和·TTL过期·

![âICMPæ¥æç±»åâçå¾çæç´¢ç»æ](https://tonydeng.github.io/sdn-handbook/basic/images/icmp-error-message.png)

## IPV6

- 地址容量从32位扩大到128位
- 不允许中途路由器对包进行分片和组装
- 首部为固定的40字节

### IPV4到IPV6的迁移

#### 双栈

- 既能处理IPV4报文又能处理IPV6报文
- 如果其中一方只能使用IPV4，那么就必须使用IPV4数据报
- 可以把IPV6数据报转换为IPV4，但是字段会有丢失 
- 建隧道：将IPV6数据报，放到IPV4数据报的数据字段中

## 路由选择算法

